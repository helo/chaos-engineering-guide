<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Run Chaos testing :: OpenShift Chaos Engineering Workshop</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/chaos-engineering/5.0/chaos-testing.html">
    <link rel="prev" href="chaos-metrics.html">
    <link rel="next" href="faq.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/course-template">OpenShift Chaos Engineering Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="chaos-engineering" data-version="5.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">OpenShift Chaos Engineering Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="chaos-environment.html">1. Get your Chaos environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="chaos-metrics.html">2. Define and monitor Chaos metrics</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="chaos-testing.html">3. Run Chaos testing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">4. FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Chaos Engineering Workshop</span>
    <span class="version">5.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenShift Chaos Engineering Workshop</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">5.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Chaos Engineering Workshop</a></li>
    <li><a href="chaos-testing.html">3. Run Chaos testing</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/chaos-engineering-guide/edit/5.0/documentation/modules/ROOT/pages/chaos-testing.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Run Chaos testing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>XX MINUTE PRACTICE</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plan_an_experiment"><a class="anchor" href="#_plan_an_experiment"></a>Plan an Experiment</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_what_is_openshift_service_mesh"><a class="anchor" href="#_what_is_openshift_service_mesh"></a>What is OpenShift Service Mesh?</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>OpenShift Service Mesh</strong> is also a service available on top of OpenShift.</p>
</div>
<div class="paragraph">
<p>As applications evolve into collections of decentralized services, managing communications and security between those services becomes more difficult.</p>
</div>
<div class="paragraph">
<p><strong>Red Hat OpenShift Service Mesh</strong> provides a uniform way to connect, manage, and observe microservices-based applications.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>What’s in <strong>Red Hat OpenShift Service Mesh</strong> ?</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_istio"></a>Istio</p>
</li>
<li>
<p><a id="tabset1_tracing"></a>Tracing</p>
</li>
<li>
<p><a id="tabset1_visualization"></a>Visualization</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_istio">
<div class="paragraph">
<p><strong>Istio</strong> is an open-source project for integrating and managing traffic flow across services. It works in concert with an underlying cluster manager (like Kubernetes). Centralized components, sidecar proxies, and node agents work together to create the data and control planes over a distributed application.</p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_tracing">
<div class="paragraph">
<p>Tracing allows you to track a single request as it makes its way between different services - or even inside a service - providing insight into the entire request process from start to finish. OpenShift service mesh uses <strong>Jaeger</strong>, an open, distributed tracing system.</p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_visualization">
<div class="paragraph">
<p>Visualization helps users see communication pathways between services, how they’re being managed, and how traffic is flowing in near-real time for easier management and troubleshooting. OpenShift service mesh uses <strong>Kiali</strong>, an open source project, to view configuration, monitor traffic, and analyze traces.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observability_with_kiali"><a class="anchor" href="#_observability_with_kiali"></a>Observability with Kiali</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Kiali</strong> provides an interactive graph view of your namespace in real time, being able to display the interactions at several levels (applications, versions, workloads), with contextual information and charts on the selected graph node or edge.</p>
</div>
<div class="paragraph">
<p><code><strong>Click on the 'Developer Observability' button below</strong></code></p>
</div>
<div class="imageblock text-center params-link">
<div class="content">
<a class="image" href="https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener"><img src="_images/developer-observability-button.png" alt="Developer Observability - Button" width="300"></a>
</div>
</div>
<div class="paragraph">
<p>Then, <code><strong>log in with OpenShift as user%USER_ID%/%OPENSHIFT_PASSWORD%'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-login.png" alt="Kiali- Log In" width="300">
</div>
</div>
<div class="paragraph">
<p>In the <strong>'Graph' view</strong>, <code><strong>enter the following configuration</strong></code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Graph Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chaos-engineering%USER_ID%</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type Graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Versioned app graph</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>'Response Time'</strong> checked</p>
<p class="tableblock"><strong>'Traffic Animation'</strong> checked</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hide&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>service*=svc.cluster.local</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The outcome is a graph with all the services, connected by the requests going through them.
You can see how the services interact with each other.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-graph.png" alt="Kiali- Graph" width="900">
</div>
</div>
<div class="paragraph">
<p><strong>TODO: EXPLAIN THE APPLICATION</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chaos_experiment_1_injecting_latencies"><a class="anchor" href="#_chaos_experiment_1_injecting_latencies"></a>Chaos Experiment 1: Injecting latencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In production, it is very common to have delay services rather than down services.</p>
</div>
<div class="paragraph">
<p><em>How does <strong>Travels Service</strong> behave when one of its dependant services experiment network latencies?</em></p>
</div>
<div class="paragraph">
<p>In the <a href="https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener">Kiali Console</a>, from the <strong>'Graph' view</strong>, <code><strong>right-click on the 'Hotels' service and select 'Details'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-right-click-hotel-service.png" alt="Kiali - Right Click Service" width="400">
</div>
</div>
<div class="paragraph">
<p>You will be redirected to the Service Details page.</p>
</div>
<div class="paragraph">
<p><code><strong>Click on the 'Actions' &gt; 'Fault Injection'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-add-fault-injection.png" alt="Kiali - Add Fault Injection" width="900">
</div>
</div>
<div class="paragraph">
<p><code><strong>Add HTTP Delay by entering the following settings:</strong></code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. HTTP Delay Settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add HTTP Delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enabled</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delay Percentage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>30</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Delayed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1s</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-configure-latency.png" alt="Kiali - Configure Latency" width="300">
</div>
</div>
<div class="paragraph">
<p><code><strong>Click on the 'Create' button</strong></code>.</p>
</div>
<div class="paragraph">
<p><strong>30% of the traffic of the 'Hotels' service has now 1 second of delay.</strong> Now let&#8217;s see the impact of the application.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://grafana-istio-system.%APPS_HOSTNAME_SUFFIX%">Chaos Engineering Dashboard</a>, you can see the result of the chaos experiment.
First, <code><strong>select the following variables on the dashboard</strong></code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Dashboard Settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chaos-engineering%USER_ID%</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>travels</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/grafana-chaos-selection.png" alt="Grafana - Chaos Selection" width="400">
</div>
</div>
<div class="paragraph">
<p>From the <strong>'Service Overview'</strong> or <strong>'Request Duration'</strong> panels, you can tell that the "Travels" service is particularly impacted when there is a network latency with one of its dependant services.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-latency-fault-overview.png" alt="Kiali - Latency Fault Overview" width="900">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-latency-fault-details.png" alt="Kiali - Latency Fault Details" width="900">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chaos_experiment_1_solving_detected_issues"><a class="anchor" href="#_chaos_experiment_1_solving_detected_issues"></a>Chaos Experiment 1: Solving detected issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To minimize the latency impact, you can use the <strong>timeout pattern</strong> which is probably the most common resilience pattern for distributed systems.
The goal is to fail a request after a certain period of time to avoid code and resources locking when the service is waiting for a response that takes too long or that might never arrive.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener">Kiali Console</a>, from the <strong>'Services' view</strong>, <code><strong>click on the 'travels' &gt; 'Actions' &gt; 'Request Timeouts'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-request-timeout-actions.png" alt="Kiali - Request Timeout Actions" width="900">
</div>
</div>
<div class="paragraph">
<p><code><strong>Add HTTP Timeout by entering the following settings:</strong></code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. HTTP Timeout Settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add HTTP Timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enabled</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>50ms</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-configure-timeout.png" alt="Kiali - Configure Timeout" width="400">
</div>
</div>
<div class="paragraph">
<p>In <a href="https://grafana-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener">Grafana</a>, from the <strong>Chaos Engineering Dashboard</strong>, <code><strong>scroll down and see the latency metrics</strong></code></p>
</div>
<div class="paragraph">
<p>After a while, you can see the impact of our configuration. Indeed, the latency on <strong>Travels</strong> service has reduced and
the latency metrics become green again.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/grafana-timeout-details-1.png" alt="Grafana - Timeout Details" width="900">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/grafana-timeout-details-2.png" alt="Grafana - Timeout Details" width="900">
</div>
</div>
<div class="paragraph">
<p>The latency issues have been fixed but the timeout pattern introduces errors for the requests which exceeds the threshold.
<code><strong>Scroll up and see the error rate metrics</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/grafana-timeout-error.png" alt="Grafana - Timeout Error" width="900">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo"><a class="anchor" href="#_todo"></a>TODO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have implemented timeouts for the travels service.
Let&#8217;s implementing a strategy of retry to mitigate these transient errors.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener">Kiali Console</a>, from the <strong>'Services' view</strong>,
<code><strong>click on the 'travels' &gt; 'Actions' &gt; 'Request Timeouts' and add HTTP Retry by entering the following settings:</strong></code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. HTTP Retry Settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add HTTP Retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enabled</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per Try Timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10ms</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-configure-retry.png" alt="Kiali - Configure Retry" width="400">
</div>
</div>
<div class="paragraph">
<p><code><strong>Back to <a href="https://grafana-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener">Grafana</a></strong></code>, you can tell the retry pattern reduces the error rates without impacting the latency.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo_2"><a class="anchor" href="#_todo_2"></a>TODO</h2>
<div class="sectionbody">

</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="chaos-metrics.html" class="query-params-link">2. Define and monitor Chaos metrics</a></span>
  <span class="next"><a href="faq.html" class="query-params-link">4. FAQ</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
